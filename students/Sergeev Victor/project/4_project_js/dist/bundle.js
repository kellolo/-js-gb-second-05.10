!function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){t.exports=class{constructor(){this.products={},this.currentProduct={},this.sum=0}addProduct(t){this.currentProduct=t,this.addProductToObject(),this.renderProductInBasket(),this.renderTotalSum(),this.addRemoveBtnsListeners()}addProductToObject(){null==this.products[this.currentProduct.id]?this.products[this.currentProduct.id]={price:this.currentProduct.price,name:this.currentProduct.name,count:1}:this.products[this.currentProduct.id].count++,console.dir(this.products)}renderProductInBasket(){let t=document.querySelector(`.productCount[data-id="${this.currentProduct.id}"]`);if(t)return void t.textContent++;let e=`\n            <tr>\n                <th scope="row">${this.currentProduct.id}</th>\n                <td>${this.currentProduct.name}</td>\n                <td>${this.currentProduct.price}</td>\n                <td class="productCount" data-id="${this.currentProduct.id}">1</td>\n                <td><i class="fas fa-trash-alt productRemoveBtn" data-id="${this.currentProduct.id}"></i></td>\n            </tr>\n        `;document.querySelector("tbody").insertAdjacentHTML("beforeend",e)}addRemoveBtnsListeners(){let t=document.querySelectorAll(".productRemoveBtn");for(let e=0;e<t.length;e++)t[e].addEventListener("click",this.removeProductListener)}renderTotalSum(){this.getTotalSum(),document.querySelector(".total").textContent=this.sum}getTotalSum(){this.sum=0;for(let t in this.products)this.sum+=this.products[t].price*this.products[t].count}removeProductListener(t){basket.removeProduct(t),basket.renderTotalSum()}removeProduct(t){let e=t.srcElement.dataset.id;this.removeProductFromObject(e),this.removeProductFromBasket(e)}removeProductFromBasket(t){let e=document.querySelector(`.productCount[data-id="${t}"]`);1==e.textContent?e.parentNode.remove():e.textContent--}removeProductFromObject(t){1==this.products[t].count?delete this.products[t]:this.products[t].count--}}},function(t,e,r){"use strict";r.r(e);var o=r(0),n=r.n(o);class s{constructor(t,e,r){this.id_product=t,this.product_name=e,this.price=r}render(){return`<div class="goods-item"><h3>${this.product_name}</h3><p>${this.price} <i class="fas fa-ruble-sign"></i></p>\n  <button class="toBasketBtn" data-id=${this.id_product} data-price=${this.price} data-name=${this.product_name}>В корзину</button>\n  </div>`}}let c=new class{constructor(){this.API_url="https://raw.githubusercontent.com/Essvitex/-js-gb-second-05.10/master/students/Sergeev%20Victor/project/4_project_js/jsonData",this.goods=[]}promisAjaxGetGoods(t){return new Promise((e,r)=>{let o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&(200===o.status?e(o.responseText):r("error of getting goods."))},o.open("GET",t,!0),o.send()})}getPromiseGoods(t){this.promisAjaxGetGoods(`${this.API_url}/catalogData.json`).then(t=>{this.goods=JSON.parse(t)}).then(()=>{this.render()}).then(()=>{document.querySelectorAll(".toBasketBtn").forEach((function(e){e.addEventListener("click",(function(e){let r=e.srcElement.dataset.id,o=e.srcElement.dataset.price,n=e.srcElement.dataset.name;t.addProduct({id:r,price:o,name:n})}))}))}).catch(t=>{console.log(t)})}render(){let t="";this.goods.forEach(e=>{const r=new s(e.id_product,e.product_name,e.price);t+=r.render()}),document.querySelector(".goods-list").innerHTML=t}},d=new n.a;c.getPromiseGoods(d)}]);